<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta
      name="description"
      content="Receive communication from CanadaLogin."
    />

    <title>Receive communications from CanadaLogin</title>

    <!---------- GC Design System CSS Shortcuts ---------->
    <link
      rel="stylesheet"
      href="https://cdn.design-system.alpha.canada.ca/@gcds-core/css-shortcuts@1.1.0/dist/gcds-css-shortcuts.min.css"
    />

    <!---------- GC Design System Components ---------->
    <!-- TODO: Replace <version-number> with the latest version number to receive corresponding updates of GC Design System Components. All notable changes will be documented in the changelog: https://github.com/cds-snc/gcds-components/blob/main/CHANGELOG.md -->
    <link
      rel="stylesheet"
      href="https://cdn.design-system.alpha.canada.ca/@gcds-core/components@1.0.0/dist/gcds/gcds.css"
    />
    <script
      type="module"
      src="https://cdn.design-system.alpha.canada.ca/@gcds-core/components@1.0.0/dist/gcds/gcds.esm.js"
    ></script>

    <!-- Custom styles -->
    <!-- TODO: If needed, uncomment and link your custom CSS file here. -->
    <!-- <link rel="stylesheet" href="path/to/custom.css" /> -->
  </head>

  <body>
    <!---------- Header ---------->
    <!-- TODO: Modify the lang-href to set the language toggle's URL. -->
    <!-- TODO: Update the skip-to-href with the main content container's id. -->
    <gcds-header lang-href="#" skip-to-href="#main-content">
      <!-- The slot="search" attribute adds the search component to the header. -->
      <gcds-search slot="search"></gcds-search>

      <!-- The slot="breadcrumb" attribute adds the breadcrumbs component to the header. -->
      <gcds-breadcrumbs slot="breadcrumb">
        <!-- TODO: Adjust the breadcrumb links with the correct ones for your site. -->
        <gcds-breadcrumbs-item href="#">Link</gcds-breadcrumbs-item>
        <gcds-breadcrumbs-item href="#">Link</gcds-breadcrumbs-item>
      </gcds-breadcrumbs>
    </gcds-header>

    <!---------- Main content ---------->
    <!-- TODO: Confirm the id matches the "skip-to-href" id in the header. -->
    <gcds-container
      id="main-content"
      layout="page"
      tag="main"
    >
      <section>
        <gcds-heading tag="h1">Receive communication from CanadaLogin</gcds-heading>
        <gcds-text>
          <strong>If you'd like to receive updates, sign up for our GC Sign in mailing list.</strong>
        </gcds-text>
      </section>

      <section id="section-1">
        <gcds-heading tag="h2">Have a question for the CanadaLogin team?</gcds-heading>
        <gcds-text>
          Go to the <gcds-link href="https://sign-in.canada.ca/en/partners/contact/">CanadaLogin contact form</gcds-link>.
        </gcds-text>
        <gcds-text>
          Learn about the personal information we collect and how we're handling it by visiting our <gcds-link href="https://sign-in.canada.ca/en/partners/privacy/">privacy page</gcds-link>.
        </gcds-text>

        <form id="comm-form">

            <gcds-input
            id="email"
            input-id="email"
            label="Email"
            name="email"
            type="email"
            hint="Please provide your government (.gc.ca) email address"
            required
            >
            </gcds-input>

          <gcds-checkboxes
            name="consent"
            id="consent"
            legend="Legend"
            options='[
              { "label": "Contact me for usability research", "id": "consent", "value": "true"}
            ]'
          >
          </gcds-checkboxes>

          <gcds-button type="submit">
            Submit
          </gcds-button>

        </form>

        <p id="msg"></p>

          <!-- <gcds-icon label="Vanilla" name="info-circle" margin-left="75"></gcds-icon>
          <gcds-link href="./vanilla.html">
            Vanilla
          </gcds-link> -->
          
        <script>
          const ENDPOINT = "https://2jugu7ddyo2ebdnzg7ec7tm6bq0waeor.lambda-url.us-east-1.on.aws/"; // replace

          const form = document.getElementById("comm-form");
          const msg  = document.getElementById("msg");

          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            msg.textContent = "Submittingâ€¦";            
            
            /* 
            let temp;

            if (document.getElementById("consent").checked) {
              temp = true;
            } else {
              temp = false;
            } */

            // const consent = temp;
            const email = document.getElementById("email").value.trim();
            const consent = (document.getElementById("consent").checked) ? true : false;

            // Optional: enforce consent == true
            // if (!consent) { msg.textContent = "You must consent to subscribe."; return; }

            try {
              const res = await fetch(ENDPOINT, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, consent })
              });

              const text = await res.text();
              let data;
              try { data = JSON.parse(text); } catch { data = { error: text }; }

              if (!res.ok || data.error) throw new Error(data.error || `HTTP ${res.status}`);

              if (data.alreadySubscribed) {
                msg.textContent = "You're already subscribed.";
              } else if (data.created) {
                msg.textContent = "Subscription successful! Check your inbox for updates.";
              } else {
                msg.textContent = "Unexpected response from server.";
              }
            } catch (err) {
              console.error(err);
              msg.textContent = `Subscription failed: ${err.message}`;
            }
          });
        </script>
        
      </section>

      <gcds-date-modified>2026-02-12</gcds-date-modified>
    </gcds-container>

    <!---------- Footer ---------->
    <!-- TODO: Update or remove the contextual footer heading and links as needed. -->
    <gcds-footer
      display="full"
      contextual-heading="Canadian Digital Service"
      contextual-links='{ "Why GC Notify": "#","Features": "#", "Activity on GC Notify": "#"}'
    >
    </gcds-footer>
  </body>
</html>